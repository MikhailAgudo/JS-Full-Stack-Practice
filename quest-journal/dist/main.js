(()=>{"use strict";const e=e=>String(e),t=e=>e,n=e=>(e>3?e=3:e<1&&(e=1),e),s=e=>String(e),r=(()=>{let r=[];const l=e=>r[e],a=(e,t)=>r[e].getTask(t);return{quests:r,addQuest:e=>{let t=(e=>{let t=[],n=[];return{getTitle:()=>e,getTasks:()=>t,getTaskAmount:()=>t.length,getTask:e=>t[e],addTask:e=>{t.push(e)},removeTask:e=>{t.splice(e,1)},processSwap:e=>{n.length<2&&(e=>{n.push(e)})(e),n.length>=2&&(()=>{const e=n.shift(),s=n.shift();let r=t[e];t[e]=t[s],t[s]=r})()}}})(e=s(e));r.push(t)},removeQuest:e=>{r.splice(e,1)},getQuests:()=>r,getQuest:l,resetQuests:()=>{r=[]},addTask:(t,n)=>{let s=(e=>({getTitle:()=>title,getDescription:()=>e,getDueDate:()=>dueDate,getPriority:()=>priority,setTitle:e=>{title=e},setDescription:t=>{e=t},setDueDate:e=>{dueDate=e},setPriority:e=>{priority=e}}))(t=e(t));l(n).addTask(s)},removeTask:(e,t)=>{l(e).removeTask(t)},renameTitle:(t,n,s)=>{s=e(s),a(t,n).setTitle(s)},changeDescription:(t,n,s)=>{s=e(s),a(t,n).setDescription(s)},changeDate:(e,n,s)=>{s=t(s),a(e,n).setDueDate(s)},changePriority:(e,t,s)=>{s=n(s),a(e,t).setPriority(s)}}})(),l=(()=>{let e=0,t=[];const n=()=>{localStorage.setItem("questLength",e)},s=e=>{let n="quest"+String(e),r=t.shift();r=String(r),n+="taskLength",localStorage.setItem(n,r),0===t.length||s(e+1)},l=(e,t)=>{let n="quest";n+=e=String(e),localStorage.setItem(n,t.getTitle()),a(t.getTasks(),n)},a=(e,t)=>{for(let n=0;n<e.length;n++){let s=t;s+="task",s+=n;let r=e[n].getDescription();console.log("SAVE: "+r),localStorage.setItem(s,r)}},o=()=>{e=r.getQuests().length},d=()=>{let e=r.getQuests();t=[];for(let n=0;n<e.length;n++){let s=e[n].getTaskAmount();t.push(s)}},i=()=>{localStorage.clear()};return{saveQuests:()=>{i(),o(),d(),n(),s(0);for(let t=0;t<e;t++){let e=r.getQuest(t);l(t,e)}},resetStorage:i}})(),a=(()=>{const e=(t,n)=>{let s=n.shift();if(t.appendChild(s),0===n.length)return t;e(t,n)},t=(e,n)=>{let s=n.shift();if(e.classList.add(s),0===n.length)return e;t(e,n)};return{appendChildren:e,addClasses:t}})(),o={render:(e,t,n)=>{let s=document.createElement("div");s.classList.add("task-container");let o=(e=>{let t=document.createElement("div");return t.classList.add("task-area"),t.textContent=e,t})(e.getDescription()),d=((e,t)=>{let n=document.createElement("button");return n.textContent="Done",n.addEventListener("click",(n=>{r.removeTask(e,t),l.saveQuests(),u.renderTaskTab()})),n})(t,n);return a.appendChildren(s,[d,o]),s}},d=(()=>{let e=!1,t=!1;const n=()=>{e=!1===e},s=()=>{t=!1===t},o=e=>{let t=document.createElement("button");return t.textContent="Add",t.addEventListener("click",(t=>{r.addQuest(e.value),n(),l.saveQuests(),u.renderQuestTab()})),t},d=e=>{let t=document.createElement("button");return t.textContent="Add",t.addEventListener("click",(()=>{let t=u.getDisplayedQuestIndex();r.addTask(e.value,t),s(),l.saveQuests(),u.renderTaskTab()})),t},i=e=>{let t=document.createElement("input");return t.type="text",t.placeholder=e,t};return{getNewQuestPrompt:()=>e,getNewTaskPrompt:()=>t,createAddButton:e=>!0===e?(()=>{let e=document.createElement("button");return e.textContent="New Quest",e.addEventListener("click",(e=>{n(),u.renderQuestTab()})),e})():(()=>{let e=document.createElement("button");return e.textContent="New Task",e.addEventListener("click",(()=>{s(),u.renderTaskTab()})),e})(),createAddPrompt:e=>!0===e?(()=>{let e=document.createElement("div"),t=i("Quest name..."),n=o(t);return a.appendChildren(e,[t,n]),e})():(()=>{let e=document.createElement("div"),t=i("Task name..."),n=d(t);return a.appendChildren(e,[t,n]),e})()}})(),i=(()=>{const e=(t,n,s,r)=>{if(-1===s)return n;switch(r){case"title":n.unshift(t[s].getTitle());break;case"description":n.unshift(t[s].getDescription());break;case"date":n.unshift(t[s].getDueDate())}return e(t,n,s-=1,r)};return{transformToUIReadable:e,questsToTitles:e=>{let t=[];for(let n=0;n<e.length;n++){let s=e[n].getTitle();t.push(s)}return t}}})(),u=(()=>{let e=0,t=document.createElement("div"),n=document.createElement("div");const s=()=>(t.classList.add("quest-section"),t),l=()=>(n.classList.add("task-section"),n),u=()=>{k(),c();let e=v();g(e)},c=()=>{let e=null;e=!0===d.getNewQuestPrompt()?d.createAddPrompt(!0):d.createAddButton(!0),t.appendChild(e)},g=e=>{for(let n=0;n<e.length;n++){let s=m(e,n);t.appendChild(s)}},m=(e,t)=>{let n=document.createElement("button");return n.textContent=e[t],n.dataset.index=t,n.addEventListener("click",(e=>{Q(t)})),n},p=()=>{f(),T();let e=D();h(e)},T=()=>{let e=null;e=!0===d.getNewTaskPrompt()?d.createAddPrompt(!1):d.createAddButton(!1),n.appendChild(e)},h=t=>{for(let s=0;s<t.length;s++){let r=o.render(t[s],e,s);n.appendChild(r)}},k=()=>{t.innerHTML=""},f=()=>{n.innerHTML=""},Q=t=>{e=t;v();u();D();p()},v=()=>i.questsToTitles(r.quests),D=()=>r.quests.length>0?r.quests[e].getTasks():[];return{initializeJournal:()=>{let e=document.querySelector(".journal-section"),t=s(),n=l();a.appendChildren(e,[t,n]),u(),p()},renderQuestTab:u,renderTaskTab:p,getDisplayedQuestIndex:()=>e,getQuestTitles:v,getTasks:D}})(),c=(()=>{let e=null,t=[];const n=(e,s)=>{if(s>0&&"number"==typeof s){let r="quest"+String(e)+"taskLength",l=localStorage.getItem(r);t.push(l),e+1===s||n(e+1,s)}},s=(e,n)=>{let s=t[n];e+="task";for(let t=0;t<s;t++){let s=e+t,l=localStorage.getItem(s);console.log("LOAD:"+l),r.addTask(l,n)}};return{load:()=>{(()=>{let t=localStorage.getItem("questLength");"number"==typeof t?(t=parseInt(t),"number"==typeof t&&(e=t)):e=0})(),n(0,e),(()=>{for(let t=0;t<e;t++){String(t);let e="quest"+t,n=localStorage.getItem(e);r.addQuest(n),s(e,t)}})()}}})();u.initializeJournal(),c.load()})();